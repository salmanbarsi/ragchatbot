{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Nxtjs/rag-chatbot/src/app/upload/pdf-reader.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { extractText } from \"unpdf\";\r\n\r\nexport async function pdfToText(data: Uint8Array) {\r\n  const result = await extractText(data);\r\n  return result.text || \"\";\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;;;;AAEO,eAAe,UAAU,IAAgB;IAC9C,MAAM,SAAS,MAAM,IAAA,sJAAW,EAAC;IACjC,OAAO,OAAO,IAAI,IAAI;AACxB;;;IAHsB;;AAAA,+OAAA"}},
    {"offset": {"line": 44, "column": 0}, "map": {"version":3,"sources":["file:///D:/Nxtjs/rag-chatbot/src/lib/db-config.ts"],"sourcesContent":["import { drizzle } from \"drizzle-orm/neon-http\";\r\nimport { neon } from \"@neondatabase/serverless\";\r\nimport {config} from 'dotenv';\r\n\r\nconfig({path: '.env.local'});\r\nconst client = neon(process.env.NEON_DATABASE_URL!);\r\nexport const db = drizzle(client);\r\n\r\nexport default db;"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,IAAA,+IAAM,EAAC;IAAC,MAAM;AAAY;AAC1B,MAAM,SAAS,IAAA,8JAAI,EAAC,QAAQ,GAAG,CAAC,iBAAiB;AAC1C,MAAM,KAAK,IAAA,mKAAO,EAAC;uCAEX"}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///D:/Nxtjs/rag-chatbot/src/lib/db-schema.ts"],"sourcesContent":["import { pgTable, serial, text, vector, index } from \"drizzle-orm/pg-core\";\r\n\r\nexport const documents = pgTable(\r\n  \"documents\",\r\n  {\r\n    id: serial(\"id\").primaryKey(),\r\n    content: text(\"content\").notNull(),\r\n    embedding: vector(\"embedding\", { dimensions: 768 }),\r\n  },\r\n  (table) => [\r\n    index(\"embeddingIndex\").using(\r\n      \"hnsw\",\r\n      table.embedding.op(\"vector_cosine_ops\")\r\n    ),\r\n  ]\r\n);\r\n\r\nexport type InsertDocument = typeof documents.$inferInsert;\r\nexport type SelectDocument = typeof documents.$inferSelect;"],"names":[],"mappings":";;;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEO,MAAM,YAAY,IAAA,gKAAO,EAC9B,aACA;IACE,IAAI,IAAA,2KAAM,EAAC,MAAM,UAAU;IAC3B,SAAS,IAAA,uKAAI,EAAC,WAAW,OAAO;IAChC,WAAW,IAAA,+LAAM,EAAC,aAAa;QAAE,YAAY;IAAI;AACnD,GACA,CAAC,QAAU;QACT,IAAA,gKAAK,EAAC,kBAAkB,KAAK,CAC3B,QACA,MAAM,SAAS,CAAC,EAAE,CAAC;KAEtB"}},
    {"offset": {"line": 89, "column": 0}, "map": {"version":3,"sources":["file:///D:/Nxtjs/rag-chatbot/src/lib/chunking.ts"],"sourcesContent":["import { RecursiveCharacterTextSplitter } from \"@langchain/textsplitters\";\r\n\r\nexport const textSplitter = new RecursiveCharacterTextSplitter({\r\n    chunkSize: 100,\r\n    chunkOverlap: 20,\r\n    separators: [\"\"],\r\n});\r\n\r\nexport async function chunkcontent(content: string) {\r\n    return await textSplitter.splitText(content.trim());\r\n}"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAEO,MAAM,eAAe,IAAI,uMAA8B,CAAC;IAC3D,WAAW;IACX,cAAc;IACd,YAAY;QAAC;KAAG;AACpB;AAEO,eAAe,aAAa,OAAe;IAC9C,OAAO,MAAM,aAAa,SAAS,CAAC,QAAQ,IAAI;AACpD"}},
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///D:/Nxtjs/rag-chatbot/src/app/upload/actions.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { pdfToText } from \"./pdf-reader\";\r\nimport { db } from \"@/lib/db-config\";\r\nimport { documents } from \"@/lib/db-schema\";\r\nimport { generateEmbeddingsMany } from \"@/lib/embeddings\";\r\nimport { chunkcontent } from \"@/lib/chunking\";\r\n\r\nexport async function processpdfFile(formData: FormData) {\r\n  try {\r\n    const file = formData.get(\"pdf\") as File;\r\n    const bytes = await file.arrayBuffer();\r\n    const uint8 = new Uint8Array(bytes);\r\n\r\n    const textOutput = await pdfToText(uint8);\r\n    const text = Array.isArray(textOutput) ? textOutput.join(\"\\n\") : textOutput;\r\n\r\n    if (!text || !text.trim()) {\r\n      return { success: false, error: \"No extractable text found.\" };\r\n    }\r\n\r\n    const rawChunks = await chunkcontent(text);\r\n    const chunks = Array.isArray(rawChunks) ? rawChunks : [rawChunks];\r\n\r\n    console.log(\"CHUNKS:\", chunks);\r\n\r\n    const embeddingResponse:any = await genrateEmbeddingsMany(chunks);\r\n    console.log(\"EMBEDDINGS RESPONSE...:\", embeddingResponse);\r\n\r\n    const embedData = embeddingResponse.data;\r\n\r\n    await db.insert(documents).values(\r\n      chunks.map((chunk, index) => ({\r\n        content: chunk,\r\n        embedding: embedData[index].embedding,  \r\n      }))\r\n    );\r\n\r\n    return {\r\n      success: true,\r\n      message: \"PDF processed & stored successfully.\",\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error:\", error);\r\n    return { success: false, error: \"Failed to process PDF\" };\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAEA;;;;;;;AAEO,eAAe,eAAe,QAAkB;IACrD,IAAI;QACF,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,QAAQ,MAAM,KAAK,WAAW;QACpC,MAAM,QAAQ,IAAI,WAAW;QAE7B,MAAM,aAAa,MAAM,IAAA,kJAAS,EAAC;QACnC,MAAM,OAAO,MAAM,OAAO,CAAC,cAAc,WAAW,IAAI,CAAC,QAAQ;QAEjE,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,IAAI;YACzB,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAA6B;QAC/D;QAEA,MAAM,YAAY,MAAM,IAAA,sIAAY,EAAC;QACrC,MAAM,SAAS,MAAM,OAAO,CAAC,aAAa,YAAY;YAAC;SAAU;QAEjE,QAAQ,GAAG,CAAC,WAAW;QAEvB,MAAM,oBAAwB,MAAM,sBAAsB;QAC1D,QAAQ,GAAG,CAAC,2BAA2B;QAEvC,MAAM,YAAY,kBAAkB,IAAI;QAExC,MAAM,gIAAE,CAAC,MAAM,CAAC,uIAAS,EAAE,MAAM,CAC/B,OAAO,GAAG,CAAC,CAAC,OAAO,QAAU,CAAC;gBAC5B,SAAS;gBACT,WAAW,SAAS,CAAC,MAAM,CAAC,SAAS;YACvC,CAAC;QAGH,OAAO;YACL,SAAS;YACT,SAAS;QACX;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,UAAU;QACxB,OAAO;YAAE,SAAS;YAAO,OAAO;QAAwB;IAC1D;AACF;;;IAtCsB;;AAAA,+OAAA"}}]
}